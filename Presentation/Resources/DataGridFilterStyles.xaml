<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:dgx="urn:tom-englert.de/DataGridExtensions">

    <!-- R-299: Excel-Style Filter Template -->
    <!-- Placeholder: Replacing complex template with simple message to ensure stable UAT build -->
    <ControlTemplate x:Key="ExcelFilterTemplate" TargetType="Control">
        <Grid>
            <!-- Toggle Button to Open Popup -->
            <ToggleButton x:Name="FilterButton"
                          IsChecked="{Binding Path=IsPopupVisible, RelativeSource={RelativeSource AncestorType=dgx:DataGridFilterColumnControl}, Mode=TwoWay}"
                          Focusable="False"
                          Content="▼" 
                          Height="20" Width="20"
                          Background="Transparent" BorderThickness="0"/>

            <!-- The Popup -->
            <Popup IsOpen="{Binding Path=IsChecked, ElementName=FilterButton, Mode=TwoWay}"
                   StaysOpen="False"
                   PlacementTarget="{Binding ElementName=FilterButton}">
                <Border Background="White" BorderBrush="#1F2937" BorderThickness="1" Padding="5" MinWidth="150" MaxHeight="300">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/> 
                            <RowDefinition Height="*"/>    
                            <RowDefinition Height="Auto"/> 
                        </Grid.RowDefinitions>

                        <!-- Search Box inside Popup (Tag is used as simple placeholder if needed, or Watermark via style) -->
                        <TextBox Grid.Row="0" Margin="0,0,0,5" 
                                 Text="{Binding Path=Filter, UpdateSourceTrigger=PropertyChanged, RelativeSource={RelativeSource AncestorType=dgx:DataGridFilterColumnControl}}" 
                                 Tag="Ara..."
                                 ToolTip="Filtrelemek için yazın..." />

                        <!-- Checkbox List -->
                        <ListBox Grid.Row="1" 
                                 ItemsSource="{Binding Path=SelectableValues, RelativeSource={RelativeSource AncestorType=dgx:DataGridFilterColumnControl}}"
                                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                                 MaxHeight="200">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <CheckBox Content="{Binding}" 
                                              Foreground="Black"
                                              IsChecked="{Binding IsSelected}" 
                                              VerticalContentAlignment="Center"
                                              Margin="2"/>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>

                        <!-- Clear Button -->
                        <Button Grid.Row="2" Content="Temizle" 
                                Command="{Binding Path=ClearCommand, RelativeSource={RelativeSource AncestorType=dgx:DataGridFilterColumnControl}}"
                                Margin="0,5,0,0"/>
                    </Grid>
                </Border>
            </Popup>
        </Grid>
    </ControlTemplate>
    
</ResourceDictionary>
