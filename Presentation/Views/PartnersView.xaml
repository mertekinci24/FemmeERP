<UserControl x:Class="InventoryERP.Presentation.Views.PartnersView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <UserControl.Resources>
    <ResourceDictionary>
      <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="/InventoryERP.Presentation;component/Resources/Theme.xaml" />
      </ResourceDictionary.MergedDictionaries>
    </ResourceDictionary>
  </UserControl.Resources>
  <DockPanel Margin="8">
  <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,0">
      <Button Content="Yeni Cari" Command="{Binding NewPartnerCommand}" Style="{StaticResource AppToolbarButton}" Width="120"/>
      <Button Content="Yenile" Command="{Binding RefreshCommand}" Style="{StaticResource AppToolbarButton}" />
  <TextBox Width="240" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" Margin="4,0,0,0" ToolTip="Unvan / rol ile ara" />
  <TextBlock Text="{Binding RowCount, StringFormat='{}{0} kayÄ±t'}" Margin="12,0,0,0" VerticalAlignment="Center"/>
    </StackPanel>
    <DataGrid x:Name="PartnersGrid"
          ItemsSource="{Binding Rows}" SelectedItem="{Binding Selected}"
          AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True" Margin="0,8,0,0"
          RowDetailsVisibilityMode="VisibleWhenSelected">
      <DataGrid.RowDetailsTemplate>
        <DataTemplate>
          <Border Background="#F5F9FF" BorderBrush="#90CAF9" BorderThickness="1" Padding="12" Margin="0,0,0,4">
            <StackPanel>
              <TextBlock Text="{Binding LastMovementSummary, TargetNullValue='HenÃ¼z hareket bulunmuyor.'}"
                         FontWeight="SemiBold" Foreground="#0D47A1"/>
              <UniformGrid Columns="3" Margin="0,10,0,0">
                <StackPanel>
                  <TextBlock Text="Toplam BorÃ§" FontWeight="SemiBold"/>
                  <TextBlock Text="{Binding TotalDebit, StringFormat='{}{0:N2}'}"/>
                </StackPanel>
                <StackPanel>
                  <TextBlock Text="Toplam Alacak" FontWeight="SemiBold"/>
                  <TextBlock Text="{Binding TotalCredit, StringFormat='{}{0:N2}'}"/>
                </StackPanel>
                <StackPanel>
                  <TextBlock Text="Son Bakiye" FontWeight="SemiBold"/>
                  <TextBlock Text="{Binding BalanceTry, StringFormat='{}{0:N2}'}"/>
                </StackPanel>
              </UniformGrid>
              <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                <TextBlock Text="Son BorÃ§:" FontWeight="SemiBold" Margin="0,0,6,0"/>
                <TextBlock Text="{Binding LastDebit, StringFormat='{}{0:N2}', TargetNullValue='0,00'}" Margin="0,0,12,0"/>
                <TextBlock Text="Son Alacak:" FontWeight="SemiBold" Margin="0,0,6,0"/>
                <TextBlock Text="{Binding LastCredit, StringFormat='{}{0:N2}', TargetNullValue='0,00'}"/>
              </StackPanel>
            </StackPanel>
          </Border>
        </DataTemplate>
      </DataGrid.RowDetailsTemplate>
      <DataGrid.RowStyle>
        <Style TargetType="DataGridRow">
          <EventSetter Event="PreviewMouseRightButtonDown" Handler="PartnerRow_PreviewMouseRightButtonDown"/>
          <Setter Property="Tag" Value="{Binding DataContext, RelativeSource={RelativeSource AncestorType=DataGrid}}"/>
          <Setter Property="ContextMenu">
            <Setter.Value>
              <ContextMenu>
                <MenuItem Header="Tahsilat/Ödeme Ekle"
                          Command="{Binding PlacementTarget.Tag.AddCashTransactionCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                          ToolTip="Müşteri için Tahsilat, Satıcı için Ödeme"/>
                <Separator/>
                <MenuItem Header="Hareketler (Ekstre)"
                          Command="{Binding PlacementTarget.Tag.StatementCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                          ToolTip="Ekstre/PDF-Excel dÄ±ÅŸa aktarÄ±m iÃ§in Hareketler dialogu"/>
                <MenuItem Header="Risk / YaÅŸlandÄ±rma"
                          Command="{Binding PlacementTarget.Tag.AgingCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                          ToolTip="Cari yaÅŸlandÄ±rma ve gecikmiÅŸ bakiye analizi"/>
                <Separator/>
                <MenuItem Header="DÄ±ÅŸa Aktar (Excel/PDF)"
                          Command="{Binding PlacementTarget.Tag.ExportCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"/>
              </ContextMenu>
            </Setter.Value>
          </Setter>
        </Style>
      </DataGrid.RowStyle>
      <DataGrid.Columns>
  <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="80"/>
  <DataGridTextColumn Header="Unvan" Binding="{Binding Name}" Width="*"/>
  <DataGridTextColumn Header="Rol" Binding="{Binding Role}" Width="120"/>
  <DataGridTextColumn Header="BorÃ§" Binding="{Binding TotalDebit, StringFormat='{}{0:N2}'}" Width="140"/>
  <DataGridTextColumn Header="Alacak" Binding="{Binding TotalCredit, StringFormat='{}{0:N2}'}" Width="140"/>
  <DataGridTextColumn Header="Kredi Limiti" Binding="{Binding CreditLimitTry, StringFormat='{}{0:N2}'}" Width="140"/>
  <DataGridTextColumn Header="Bakiye" Binding="{Binding BalanceTry, StringFormat='{}{0:N2}'}" Width="140"/>
      </DataGrid.Columns>
    </DataGrid>
  </DockPanel>
</UserControl>
